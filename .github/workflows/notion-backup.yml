name: Notion Backup

on:
schedule:
    # 每天北京时间上午 8 点运行一次（UTC 时间 0 点）
-cron:'0 0 * * *'
workflow_dispatch: # 允许手动触发

jobs:
backup:
runs-on: ubuntu-latest

steps:
-name: Checkout repository
uses: actions/checkout@v4

-name: Notion Backup to Markdown
uses: thecommoncoder/notion-backup@v2
with:
notion-token: ${{ secrets.NOTION_TOKEN }}
notion-page-id: ${{ secrets.NOTION_PAGE_ID }}
output-dir:'./backup'

-name: Commit and push changes
    run:|
      git config --local user.email "github-actions[bot]@users.noreply.github.com"
      git config --local user.name "github-actions[bot]"
      git add ./backup
      git diff --staged --quiet || git commit -m "Auto backup from Notion - $(date '+%Y-%m-%d %H:%M:%S')"
      git push

-name: Upload to GitHub Releases
uses: softprops/action-gh-release@v1
with:
tag_name: backup-${{ github.run_number }}
name: Backup - ${{ github.run_number }}
draft:false
prerelease:false
files: ./backup/**/*.md
env:
GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
if: success()
